<!doctype html>
<html>
<head>
	<title>Queries</title>
	<link rel = "stylesheet" href = "styles/standard.css" type = "text/css" />
    <link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
    <script src="jquery.validate.min.js" type="text/javascript"></script>
    <script src="additional-methods.min.js" type="text/javascript"></script>
    <script type="text/javascript">
    jQuery.validator.addMethod("aggAllowed", function(value, element) {
        if (document.querySelector('input[id=Population]').checked &&
            document.querySelector('input[id=Elevation]').checked)
        {
            return this.optional(element) || !(document.querySelector('input[id=sum]').checked)
                   || !(document.querySelector('input[id=avg]').checked)
                   || !(document.querySelector('input[id=min]').checked)
                   || !(document.querySelector('input[id=max]').checked);
        }
        return true;
    }, "Nothing to perform aggregate function over.");
    $(document).ready(function () {
        $('#query').validate({
            rules: {
                'attributes[]': {
                    required: true,
                    aggAllowed: true
                    },
                'sum_over[]': {required: true}
            },
            messages: {
                'attributes[]': {required: "Please select at least one attribute."},
                'sum_over[]': {required: "Please select at least one attribute to perform function over. <br />"}
            },
            errorPlacement: function(error, element) {
                if (element.attr( "name" ) === "attributes[]") 
                {
                    $(element).next().after(error);
                } 
                else if (element.attr( "name" ) === "sum_over[]")
                {
                    error.insertBefore( '#sum' );
                }
                else
                {
                    error.insertAfter( element );
                }
            }
        });
        window.onload = function () {
            var inputs = [document.querySelector('input[id=asciiname]'),
                          document.querySelector('input[id=Country]'),
                          document.querySelector('input[id=Population]'),
                          document.querySelector('input[id=Elevation]'),
                          document.querySelector('input[id=Latitude]'),
                          document.querySelector('input[id=Longitude]'),
                          document.querySelector('input[id=time_zone]'),
                          document.querySelector('input[id=sum]'),
                          document.querySelector('input[id=avg]'),
                          document.querySelector('input[id=min]'),
                          document.querySelector('input[id=max]')];
            function check() 
            {
                var a = ""; //sum
                if (inputs[7].checked) 
                {
                    for (i = 2; i < 4; ++i)
                    {
                        if (!inputs[i].checked)
                        {
                            var val = inputs[i].value;
                            a = a + "<input type='checkbox' name='sum_over[]' value='" +
                                val + "'id='sum" + val + "' />" +
                                "<label for='sum" + val + "' >" + inputs[i].id + "</label>";
                        }
                    }
                }
                document.getElementById('sum_result').innerHTML = a;
                
                var b = ""; //avg
                if (inputs[8].checked)
                {
                    for (i = 2; i < 4; ++i)
                    {
                        if (!inputs[i].checked)
                        {
                            var val = inputs[i].value;
                            b = b + "<input type='checkbox' name='avg_over[]' value='" +
                            val + "'id='avg" + val + "' />" +
                            "<label for='avg" + val + "' >" + inputs[i].id + "</label>";
                        }
                    }
                }
                document.getElementById('avg_result').innerHTML = b;
                
                var c = ""; //min
                if (inputs[9].checked)
                {
                    for (i = 2; i < 4; ++i)
                    {
                        if (!inputs[i].checked)
                        {
                            var val = inputs[i].value;
                            b = b + "<input type='checkbox' name='min_over[]' value='" +
                            val + "'id='min" + val + "' />" +
                            "<label for='min" + val + "' >" + inputs[i].id + "</label>";
                        }
                    }
                }
                document.getElementById('min_result').innerHTML = c;
                
                var d = ""; //max
                if (inputs[10].checked)
                {
                    for (i = 2; i < 4; ++i)
                    {
                        if (!inputs[i].checked)
                        {
                            var val = inputs[i].value;
                            b = b + "<input type='checkbox' name='max_over[]' value='" +
                            val + "'id='max" + val + "' />" +
                            "<label for='max" + val + "' >" + inputs[i].id + "</label>";
                        }
                    }
                }
                document.getElementById('max_result').innerHTML = d;

                for (i = 0; i < 7; ++i)
                {
                    var textBoxHTML = "";
                    var spanName = inputs[i].id + "Where";
                    if (inputs[i].checked)
                    {
                        textBoxHTML = "<input type='text' name='wheres[]' value='sweg' />";
                    }
                    document.getElementById(spanName).innerHTML = textBoxHTML;
                }
            }
            for (i = 0; i < inputs.length; i++)
            {
                inputs[i].onchange = check;
            }
        }
    });
    </script>
</head>	
	<body>
		<h2>Queries</h2>
		<div id = "box">
			<ul id = "toolBar">
				<li><a href = "index.html">Home</a></li>
				<li><a href = "Queries.html">Queries</a></li>
				<li><a href = "FAQ.html">FAQ</a></li>
				<li><a href = "Queries.html">Queries</a></li>
				<li><a href = "User.html">User</a></li>
			</ul>
			<form id="query" action="cities.php" method="post" target="_blank">
				Check which attributes you would like to see: <br />
				<input type="checkbox" name="attributes[]" value="asciiname" id="asciiname" />
                <label for="asciiname">Name</label>
                <span id="asciinameWhere"></span><br />
				<input type="checkbox" name="attributes[]" value="Country" id="Country" />
                <label for="Country">Country</label>
                <span id="CountryWhere"></span><br />
				<input type="checkbox" name="attributes[]" value="Population" id="Population" />
                <label for="Population">Population</label>
                <span id="PopulationWhere"></span><br />
				<input type="checkbox" name="attributes[]" value="dem" id="Elevation" />
                <label for="Elevation">Elevation</label>
                <span id="ElevationeWhere"></span><br />
				<input type="checkbox" name="attributes[]" value="Latitude" id="Latitude" />
                <label for="Latitude">Latitude</label><br />
				<input type="checkbox" name="attributes[]" value="Longitude" id="Longitude" />
                <label for="Longitude">Longitude</label><br />
                <input type="checkbox" name="attributes[]" value="time_zone" id="time_zone" />
                <label for="time_zone">Time Zone</label><br />
                <input type="checkbox" name="attributes[]" value="SUM" id="sum" />
                <label for="sum">Sum</label>
                <span id="sum_result"></span><br />
                <input type="checkbox" name="attributes[]" value="AVG" id="avg" />
                <label for="avg">Average</label>
                <span id="avg_result"></span><br />
                <input type="checkbox" name="attributes[]" value="MIN" id="min" />
                <label for="min">Minimum</label>
                <span id="min_result"></span><br />
                <input type="checkbox" name="attributes[]" value="MAX" id="max" />
                <label for="max">Maximum</label>
                <span id="max_result"></span><br />
                Enter the maximum number of results you would like returned (leave blank for returning all):  <br />
                <input type="number" size="6" name="num_rows" min="1" max="100000" value="500" /><br />
				<input type="submit" />
			</form>
		</div>
		<p> insert box here</p>
	</body>
</html>
