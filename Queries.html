<!doctype html>
<html>
<head>
	<title>Queries</title>
	<link rel = "stylesheet" href = "styles/standard.css" type = "text/css" />
    <link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
    <script src="jquery.validate.min.js" type="text/javascript"></script>
    <script src="additional-methods.min.js" type="text/javascript"></script>
    <script type="text/javascript">
    jQuery.validator.addMethod("aggAllowed", function(value, element) {
        if (document.querySelector('input[id=Population]').checked &&
            document.querySelector('input[id=Elevation]').checked)
        {
            return this.optional(element) || !(document.querySelector('input[id=sum]').checked);
        }
        return true;
    }, "Nothing to sum over.");
    $(document).ready(function () {
        $('#query').validate({
            rules: {
                'attributes[]': {
                    required: true,
                    aggAllowed: true
                    },
                'sum_over[]': {required: true}
            },
            messages: {
                'attributes[]': {required: "Please select at least one attribute."},
                'sum_over[]': {required: "Please select at least one attribute to sum over. <br />"}
            },
            errorPlacement: function(error, element) {
                if (element.attr( "name" ) === "attributes[]") 
                {
                    $(element).next().after(error);
                } 
                else if (element.attr( "name" ) === "sum_over[]")
                {
                    error.insertBefore( '#sum' );
                }
                else
                {
                    error.insertAfter( element );
                }
            }
        });
        window.onload = function () {
            var inputs = [document.querySelector('input[id=sum]'),
                          document.querySelector('input[id=asciiname]'),
                          document.querySelector('input[id=Country]'),
                          document.querySelector('input[id=Population]'),
                          document.querySelector('input[id=Elevation]'),
                          document.querySelector('input[id=Latitude]'),
                          document.querySelector('input[id=Longitude]'),
                          document.querySelector('input[id=time_zone]')];
            function check() 
            {
                var a = "";
                if (inputs[0].checked) 
                {
                    for (i = 3; i < 5; ++i)
                    {
                        if (!inputs[i].checked)
                        {
                            var val = inputs[i].value;
                            a = a + "<input type='checkbox' name='sum_over[]' value='" +
                                val + "'id='sum" + val + "' />" +
                                "<label for='sum" + val + "' >" + inputs[i].id + "</label>";
                        }
                    }
                } 
                document.getElementById('sum_result').innerHTML = a;
            }
            for (i=0; i < 7; i++)
            {
                if (i === 0 || i === 3 || i === 4)
                {
                    inputs[i].onchange = check;
                    check();
                }
            }
        }
    });
    </script>
</head>	
	<body>
		<h2>Queries</h2>
		<div id = "box">
			<ul id = "toolBar">
				<li><a href = "index.html">Home</a></li>
				<li><a href = "Queries.html">Queries</a></li>
				<li><a href = "FAQ.html">FAQ</a></li>
				<li><a href = "Queries.html">Queries</a></li>
				<li><a href = "User.html">User</a></li>
			</ul>
			<form id="query" action="cities.php" method="post" target="_blank">
				Check which attributes you would like to see: <br />
				<input type="checkbox" name="attributes[]" value="asciiname" id="asciiname" />
                <label for="asciiname">Name</label><br />
				<input type="checkbox" name="attributes[]" value="Country" id="Country" />
                <label for="Country">Country</label><br />
				<input type="checkbox" name="attributes[]" value="Population" id="Population" />
                <label for="Population">Population</label><br />
				<input type="checkbox" name="attributes[]" value="dem" id="Elevation" />
                <label for="Elevation">Elevation</label><br />
				<input type="checkbox" name="attributes[]" value="Latitude" id="Latitude" />
                <label for="Latitude">Latitude</label><br />
				<input type="checkbox" name="attributes[]" value="Longitude" id="Longitude" />
                <label for="Longitude">Longitude</label><br />
                <input type="checkbox" name="attributes[]" value="time_zone" id="time_zone" />
                <label for="time_zone">Time Zone</label><br />
                <input type="checkbox" name="attributes[]" value="SUM" id="sum" />
                <label for="sum">Sum</label>
                <span id="sum_result"></span>
                <br />
                Enter the number of results you would like returned: <br />
                <input type="number" size="6" name="num_rows" min="1" max="100000" value="500" required /><br />
				<input type="submit" />
			</form>
		</div>
		<p> insert box here</p>
	</body>
</html>
